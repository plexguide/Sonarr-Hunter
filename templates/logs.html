{% extends "base.html" %}
{% set active_page = 'logs' %}

{% block title %}Huntarr - Logs{% endblock %}

{% block content %}
<div id="logsContainer" class="content-section">
    <!-- App Selector Tabs -->
    <div class="app-selector">
        <button class="app-tab active" data-app="sonarr">Sonarr</button>
        <button class="app-tab" data-app="radarr">Radarr</button>
        <button class="app-tab" data-app="lidarr">Lidarr</button>
        <button class="app-tab" data-app="readarr">Readarr</button>
    </div>
    
    <div id="logCountdown" class="log-countdown"></div>
    <div class="log-controls">
        <div class="connection-status">
            Status: <span id="status" class="status-disconnected">Disconnected</span>
        </div>
        <div class="auto-scroll">
            <label>
                <input type="checkbox" id="autoScroll" checked>
                Auto-scroll
            </label>
        </div>
        <button id="clearLogs" class="clear-button">Clear Logs</button>
    </div>
    <div id="logs" class="logs"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get elements
        const appTabs = document.querySelectorAll('.app-tab');
        const logsElement = document.getElementById('logs');
        const statusElement = document.getElementById('status');
        const clearLogsButton = document.getElementById('clearLogs');
        const autoScrollCheckbox = document.getElementById('autoScroll');
        
        // Set default app if not already set
        if (typeof currentApp === 'undefined') {
            window.currentApp = 'sonarr';
        }
        
        // Update connection status
        function updateLogsConnectionStatus() {
            if (statusElement) {
                if (window.configuredApps && window.configuredApps[currentApp]) {
                    statusElement.textContent = 'Connected';
                    statusElement.className = 'status-connected';
                } else {
                    statusElement.textContent = 'Disconnected';
                    statusElement.className = 'status-disconnected';
                }
            }
        }
        
        // Auto-scroll function
        function scrollToBottom() {
            if (autoScrollCheckbox && autoScrollCheckbox.checked && logsElement) {
                logsElement.scrollTop = logsElement.scrollHeight;
            }
        }
        
        // Clear logs
        if (clearLogsButton) {
            clearLogsButton.addEventListener('click', function() {
                if (logsElement) logsElement.innerHTML = '';
            });
        }
        
        // Tab switching
        appTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const app = this.dataset.app;
                
                // If it's already the active app, do nothing
                if (app === currentApp) return;
                
                // Update active tab
                appTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update current app
                window.currentApp = app;
                
                // Clear the logs
                if (logsElement) logsElement.innerHTML = '';
                
                // Update connection status
                updateLogsConnectionStatus();
                
                // Connect to event source if app is configured
                if (window.connectEventSource && window.configuredApps && window.configuredApps[app]) {
                    window.connectEventSource(app);
                }
            });
        });
        
        // Initial connection status update
        updateLogsConnectionStatus();
        
        // Connect to event source if app is configured
        if (window.connectEventSource && window.configuredApps && window.configuredApps[currentApp]) {
            window.connectEventSource(currentApp);
        }
        
        // Re-enable auto-scroll when checkbox is checked
        if (autoScrollCheckbox) {
            autoScrollCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    scrollToBottom();
                }
            });
        }
    });
</script>
{% endblock %}
